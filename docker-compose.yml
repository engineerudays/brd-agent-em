version: '3.8'

services:
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n-brd-agent
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      # Timezone
      - TZ=America/Los_Angeles
      
      # Basic Auth (Optional - comment out if not needed)
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=change-this-password
      
      # Execution settings
      - EXECUTIONS_PROCESS=main
      - EXECUTIONS_TIMEOUT=3600
      - EXECUTIONS_TIMEOUT_MAX=7200
      
      # Webhook URL (adjust if using a custom domain)
      - WEBHOOK_URL=http://localhost:5678/
    
    volumes:
      # n8n data persistence
      - ~/.n8n:/home/node/.n8n
      
      # Mount your entire projects folder
      - /Users/udayammanagi/Udays-Folder:/data/projects
    
    networks:
      - n8n-network

  brd-parser:
    build: ./brd_parser
    container_name: brd-parser-service
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    env_file:
      - ./brd_parser/.env
    networks:
      - n8n-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  n8n-network:
    driver: bridge

# To use this:
# 1. Create brd_parser/.env with ANTHROPIC_API_KEY (see brd_parser/ENV_TEMPLATE.md)
# 2. Run: docker-compose up -d
# 3. Access n8n at: http://localhost:5678
# 4. Access BRD Parser API at: http://localhost:8000
# 5. Login to n8n with: admin / change-this-password (change these!)
# 6. Import your workflows from n8n_flows/planning_agent/

# Useful commands:
# - Start: docker-compose up -d
# - Stop: docker-compose down
# - View logs: docker-compose logs -f n8n
# - Restart: docker-compose restart

